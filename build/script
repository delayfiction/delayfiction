#!/usr/bin/env ruby

require 'fileutils'
require_relative 'post.rb'
require_relative 'issue.rb'

Dir.foreach(Dir.pwd + "/src/issues") do |y|
  if y[-3..-1] == ".md"
    issue = Issue.new(Dir.pwd + "/src/issues/" + y)
    if Dir.exist?(issue.directory) == false
      FileUtils.mkdir(issue.directory)
    end
    File.write(issue.directory + y, issue.html)
  end
end

Dir.foreach(Dir.pwd + "/src/posts") do |x|
  if x[-3..-1] == ".md"
    post = Post.new(Dir.pwd + "/src/posts/" + x)
    template = File.read(Dir.pwd + "/build/show-post.html.erb")
    File.write(post.issue_dir + x[0..-4] + '.html', post.render(template))
  end
end
